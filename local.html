<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super LS Manager V3</title>
    <style>
        /* --- CSS & Responsiveness --- */
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #121212; color: #f1f1f1; margin: 0; padding: 20px; display: flex; justify-content: center; }
        
        .container { background: #1e1e1e; width: 100%; max-width: 950px; border-radius: 12px; padding: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.6); border: 1px solid #333; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .header h2 { margin: 0; color: #00ffcc; font-size: 22px; }
        .stats { background: #2a2a2a; padding: 8px 12px; border-radius: 6px; font-size: 14px; color: #00ffcc; border: 1px solid #444; font-weight: bold;}

        /* Form, Search, & Buttons */
        .controls { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .input-group { display: flex; gap: 10px; flex: 1; min-width: 250px; flex-wrap: wrap; }
        input[type="text"] { flex: 1; min-width: 120px; padding: 10px; background: #2b2b2b; border: 1px solid #444; color: #fff; border-radius: 6px; outline: none; }
        input[type="text"]:focus { border-color: #00ffcc; }
        button { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px; }
        button:hover { opacity: 0.8; }
        
        .btn-add { background: #28a745; color: white; flex: 1; min-width: 100px; }
        
        /* Table Layout */
        .table-wrapper { overflow-x: auto; background: #222; border: 1px solid #444; border-radius: 8px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; text-align: left; min-width: 700px; }
        th { background: #111; color: #00ffcc; padding: 12px; position: sticky; top: 0; font-size: 14px; white-space: nowrap;}
        td { padding: 12px; border-bottom: 1px solid #333; font-size: 13px; }
        tr:hover { background: #2a2a2a; }
        
        .key-cell { font-weight: bold; color: #fff; word-break: break-all; max-width: 150px; }
        .val-cell { color: #ccc; font-family: monospace; word-break: break-all; max-width: 250px; }
        .size-cell { color: #ff9800; white-space: nowrap; font-weight: bold;}
        .time-cell { color: #aaa; white-space: nowrap; font-size: 12px; }
        
        .action-btns { display: flex; gap: 5px; }
        .btn-icon { padding: 6px 10px; font-size: 13px; border-radius: 4px; }
        .btn-edit { background: #ffc107; color: #000; }
        .btn-copy { background: #007bff; color: #fff; }
        .btn-del { background: #dc3545; color: #fff; }

        /* Bottom Actions */
        .bottom-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .bottom-actions button { flex: 1; min-width: 140px; }
        .btn-export { background: #17a2b8; color: white; }
        .btn-import { background: #6f42c1; color: white; }
        .btn-clear { background: #dc3545; color: white; width: 100%; margin-top: 10px; }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            .input-group { flex-direction: column; width: 100%; }
            .controls { flex-direction: column; }
            button { width: 100%; }
            .stats { width: 100%; text-align: center; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h2>üöÄ Super LS Manager V3</h2>
            <div class="stats" id="ls-size">Total: 0 KB</div>
        </div>

        <div class="controls">
            <input type="text" id="search-input" placeholder="üîç Cari Key atau Value..." onkeyup="app.render()">
        </div>

        <div class="controls">
            <div class="input-group">
                <input type="text" id="input-key" placeholder="Key (Kunci)...">
                <input type="text" id="input-val" placeholder="Value (Isi Data)...">
            </div>
            <button class="btn-add" onclick="app.save()">üíæ Save</button>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th style="width: 20%;">Key</th>
                        <th style="width: 35%;">Value</th>
                        <th style="width: 10%;">Ukuran</th>
                        <th style="width: 20%;">Terakhir Update</th>
                        <th style="width: 15%;">Aksi</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    </tbody>
            </table>
        </div>

        <div class="bottom-actions">
            <button class="btn-export" onclick="app.export()">üì• Export JSON</button>
            <button class="btn-import" onclick="document.getElementById('import-file').click()">üì§ Import JSON</button>
            <input type="file" id="import-file" accept=".json" style="display:none;" onchange="app.import(event)">
        </div>
        <button class="btn-clear" onclick="app.clearAll()">üö® HAPUS SEMUA DATA üö®</button>
    </div>

    <script>
        const app = {
            META_KEY: '__uls_meta', // Key rahasia buat nyimpen waktu update

            // Ambil data waktu update
            getMeta: function() {
                try { return JSON.parse(localStorage.getItem(this.META_KEY)) || {}; } 
                catch(e) { return {}; }
            },

            // Format Ukuran Bytes ke KB
            formatBytes: function(bytes) {
                if (bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },

            // Format Waktu
            formatTime: function(timestamp) {
                if (!timestamp) return 'Belum ada riwayat';
                const d = new Date(timestamp);
                return d.toLocaleString('id-ID', { day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit' });
            },

            render: function() {
                const tbody = document.getElementById('table-body');
                const searchQ = document.getElementById('search-input').value.toLowerCase();
                const meta = this.getMeta();
                tbody.innerHTML = '';
                
                let totalBytes = 0;

                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    // Sembunyiin key rahasia supaya gak menuhin tabel
                    if (key === this.META_KEY) continue; 

                    const val = localStorage.getItem(key);
                    
                    // Hitung ukuran (1 karakter = 2 bytes di UTF-16 JavaScript)
                    const itemBytes = (key.length + val.length) * 2; 
                    totalBytes += itemBytes;

                    if (key.toLowerCase().includes(searchQ) || val.toLowerCase().includes(searchQ)) {
                        let displayVal = val.length > 50 ? val.substring(0, 50) + '...' : val;
                        let lastUpdate = this.formatTime(meta[key]);

                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td class="key-cell">${key}</td>
                            <td class="val-cell" title='${val.replace(/'/g, "&#39;")}'>${displayVal}</td>
                            <td class="size-cell">${this.formatBytes(itemBytes)}</td>
                            <td class="time-cell">${lastUpdate}</td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn-icon btn-edit" onclick="app.edit('${key}')" title="Edit">‚úèÔ∏è</button>
                                    <button class="btn-icon btn-copy" onclick="app.copy('${key}')" title="Copy">üìã</button>
                                    <button class="btn-icon btn-del" onclick="app.del('${key}')" title="Hapus">‚ùå</button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    }
                }

                document.getElementById('ls-size').innerText = `Total Terpakai: ${this.formatBytes(totalBytes)}`;
            },

            save: function() {
                const k = document.getElementById('input-key').value.trim();
                const v = document.getElementById('input-val').value.trim();
                if (k) {
                    localStorage.setItem(k, v);
                    
                    // Catat waktu update
                    const meta = this.getMeta();
                    meta[k] = Date.now();
                    localStorage.setItem(this.META_KEY, JSON.stringify(meta));

                    document.getElementById('input-key').value = '';
                    document.getElementById('input-val').value = '';
                    this.render();
                } else {
                    alert('Key tidak boleh kosong!');
                }
            },

            edit: function(key) {
                document.getElementById('input-key').value = key;
                document.getElementById('input-val').value = localStorage.getItem(key);
                window.scrollTo({ top: 0, behavior: 'smooth' }); 
            },

            copy: function(key) {
                const val = localStorage.getItem(key);
                navigator.clipboard.writeText(val).then(() => alert('‚úÖ Value berhasil di-copy!'));
            },

            del: function(key) {
                if(confirm(`Hapus data "${key}"?`)) {
                    localStorage.removeItem(key);
                    
                    // Hapus juga riwayat waktunya
                    const meta = this.getMeta();
                    delete meta[key];
                    localStorage.setItem(this.META_KEY, JSON.stringify(meta));
                    
                    this.render();
                }
            },

            clearAll: function() {
                if(confirm('üî• YAKIN HAPUS SEMUA DATA LOCALSTORAGE? üî•')) {
                    localStorage.clear();
                    this.render();
                }
            },

            export: function() {
                let data = {};
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if(key !== this.META_KEY) data[key] = localStorage.getItem(key);
                }
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `LS_Backup_${new Date().getTime()}.json`;
                a.click();
            },

            import: function(e) {
                const file = e.target.files[0];
                if(!file) return;
                const reader = new FileReader();
                reader.onload = function(evt) {
                    try {
                        const data = JSON.parse(evt.target.result);
                        const meta = app.getMeta();
                        const now = Date.now();

                        for(let key in data) {
                            localStorage.setItem(key, data[key]);
                            meta[key] = now; // Catat waktu pas di-import
                        }
                        localStorage.setItem(app.META_KEY, JSON.stringify(meta));
                        app.render();
                        alert('‚úÖ Import sukses!');
                    } catch(err) {
                        alert('‚ùå Error: Format JSON tidak valid!');
                    }
                };
                reader.readAsText(file);
                e.target.value = ''; 
            }
        };

        app.render();
    </script>
</body>
</html>
